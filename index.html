<!DOCTYPE html>
<html lang="en">
   <head runat="server">
      <asp:ContentPlaceHolder ID="htmlHead" runat="server" />
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="refresh" content="600" />
      <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
      <meta http-equiv="Pragma" content="no-cache" />
      <meta http-equiv="Expires" content="0" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width = device-width, initial-scale = 1">
      <title>NorEMSO Gliders</title>
      <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-bootstrap.min-v0.2.css">
      <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.2.css">
      <link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
      <style>
         .btn-group{
         margin-bottom: 20px;
         }
         #mapViewDiv {
         width: 100%;
         height: 350px;
         margin: 0;
         padding-bottom: 0;
         position: relative;
         }
         h1, h2 {
         margin-top: 80px;
         margin-bottom: 15px;
         }
         p {
         margin-top: 20px;
         margin-left: 20px;  
         color: #8891a0;
         font-size: 90%;
         }
         #meta {
         margin-top: 20px;
         margin-bottom: 20px;
         }
         .container img{
         display: block;
         padding-top: 20px;
         padding-bottom: 20px;
         margin: 0 auto;
         }
      </style>
   </head>
   <body class="calcite-nav-top">
      <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark">
         <div class="calcite-title calcite-overflow-hidden">
            <a target="" href="index.html">
            <img src="static/images/uib.png" style="cursor: default; height: 45px; margin-top: 0px; margin-right: 0px; margin-left: 4px;">
            </a>
            <span class="calcite-title-divider"></span>
            <span class="calcite-title-main">NorEMSO Ocean Gliders</span>
         </div>
      </nav>

      <div class="container">
         <div class="row">
            <div class="page-header-title col-lg-6 col-md-6 col-sm-12">
               <h2 class="text-left">Deployment Data</h2>
            </div>
         </div>
         <div id="plotly"></div>
         <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
               
               <div class="btn-group">
                  <button class="btn btn-default dropdown-toggle gliderBtn" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu dropdownSelectGliders" aria-labelledby="dropdownMenu1"></ul>
               </div>



               <div class="btn-group">
                  <button class="btn btn-primary" id="displayBtn" type="button" aria-haspopup="true" aria-expanded="true">Display
                  </button>
               </div>

            </div>
         </div>
         <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
               <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation" class="active"><a href="#surfacings" aria-controls="surfacings" role="tab" data-toggle="tab">Surfacings</a></li>
                  <li role="presentation"><a href="#surface" aria-controls="surface" role="tab" data-toggle="tab">Surface Data</a></li>
                  <li role="presentation"><a href="#segments" aria-controls="segments" role="tab" data-toggle="tab">Segments</a></li>
                  <li role="presentation"><a href="#flight" aria-controls="flight" role="tab" data-toggle="tab">Flight</a></li>
                  <li role="presentation"><a href="#science" aria-controls="science" role="tab" data-toggle="tab">Science</a></li>
               </ul>
               <div class="tab-content">
                  <div role="tabpanel" class="tab-pane fade in active" id="surfacings"></div>
                  <div role="tabpanel" class="tab-pane fade" id="surface"></div>
                  <div role="tabpanel" class="tab-pane fade" id="segments"></div>                  
                  <div role="tabpanel" class="tab-pane fade" id="flight"></div>
                  <div role="tabpanel" class="tab-pane fade" id="science"></div>
               </div>
            </div>
         </div>
      </div>
      <div class="panel-footer panel-primary img-rounded">
         <p class="text-muted text-right"><br>NorGliders Real-time Glider Data Portal</p>
      </div>
      </div>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
      <script src="https://js.arcgis.com/4.5/"></script>
      <script src="js/calcitemaps-v0.4.js"></script>
      
      <script>
         // SCRIPT FOR GLIDER.HTML
         // $("#hideData").hide();
         var fvars = [ 'm_depth', 'm_ballast_pumped', 'm_battpos', 'm_pitch', 'm_heading', 'm_battpos_Vs_m_pitch', 'c_heading_Vs_m_heading'] //, 'm_digifin_leakdetect_reading', 'm_roll',]; 
         var svars = [ 'profile_sci_water_temp', 'profile_salinity', 'profile_potential_density', 'profile_dissolved_oxygen', 'profile_sci_flbbcd_chlor_units', 'profile_sci_flbbcd_cdom_units', 'profile_sci_flbbcd_bb_units', 'profile_sci_bsipar_par'];
         //var svars = [ 'profile_sci_water_temp', 'profile_salinity', 'profile_potential_density', 'profile_dissolved_oxygen', 'profile_sci_bb3slo_b470_scaled','profile_sci_bb3slo_b532_scaled','profile_sci_bb3slo_b660_scaled' ];

         var svars_2 = [ 'time_scatter_sci_water_temp', 'time_scatter_salinity', 'time_scatter_potential_density', 'time_scatter_dissolved_oxygen', 'time_scatter_sci_flbbcd_chlor_units', 'time_scatter_sci_flbbcd_cdom_units', 'time_scatter_sci_flbbcd_bb_units', 'time_scatter_sci_bsipar_par'];
         //var svars_2 = [ 'time_scatter_sci_water_temp', 'time_scatter_salinity', 'time_scatter_potential_density', 'time_scatter_dissolved_oxygen', 'time_scatter_sci_bb3slo_b470_scaled','time_scatter_sci_bb3slo_b532_scaled','time_scatter_sci_bb3slo_b660_scaled'];

         var svars_seg = [ 'CTD_profile', 'CTD_scatter', 'profile-salinity','profile-sci_water_temp', 'profile-dissolved_oxygen', 'BBFLCD_profile', 'profile-sci_flbbcd_chlor_units', 'profile-sci_flbbcd_cdom_units', 'profile-sci_flbbcd_bb_units', 'profile-sci_bsipar_par' ];
         //var svars_seg = [ 'CTD_profile', 'CTD_scatter', 'profile-salinity','profile-sci_water_temp', 'profile-dissolved_oxygen', 'profile-sci_bb3slo_b470_scaled', 'profile-sci_bb3slo_b532_scaled','profile-sci_bb3slo_b660_scaled',];

         var svars_seg_2 = [ 'CTD_scatter' ];
         var tvars = [ 'battery_diagnostics', 'm_battery', 'm_coulomb_amphr_total','m_coulomb_amphr', 'm_lithium_battery_relative_charge','srf_dac','speed','m_final_water_vx','m_final_water_vy','u_use_current_correction','m_vacuum','m_leakdetect_voltage_forward','m_leakdetect_voltage','m_digifin_leakdetect_reading','m_iridium_signal_strength','m_iridium_attempt_num', 'm_tot_num_inflections', 'm_tot_horz_dist','m_last_yo_time','c_autoballast_state'];
         console.log('hi 1')
         alert('hi 1')


         // --- Read JSON ---
         $.getJSON("../static/active_gliders_surface.json", function(obj) {  

           console.log('hi 2')
           alert('hi 2')
           var gliderNames = Object.keys(obj.gliders);
           var gliderObj = obj.gliders; 

           // Loop through active gliders
           for (var g in gliderNames) {
               // Insert glider names into nav bar and dropdown button
               var htmlStrDropdown = '<li><a href="gliders.html">' + gliderNames[g] + '</a></li>'
               $('.dropdownGliders').append(htmlStrDropdown);

               var htmlStrDropdown2 = '<li><a href="surfacings.html">' + gliderNames[g] + '</a></li>'
               $('.dropdownGliders2').append(htmlStrDropdown2);

               var htmlStrDropdown3 = '<li><a href="segments.html">' + gliderNames[g] + '</a></li>'
               $('.dropdownGliders3').append(htmlStrDropdown3);


                  // Make first glider default
                 if(g==0){
                  var gliderDropdownStr = ('<li><a>' + gliderNames[g] + '</a></li>'); 
                  $('.gliderBtn').html(gliderNames[g] + ' <span class="caret"></span>');
                  $('.dropdownSelectGliders').append(gliderDropdownStr);
                  $('.dropdownSelectGliders li').last().addClass("selectGlider1")
                  $('.dropdownSelectGliders li').last().addClass("selected1")
                  $('.dropdownSelectGliders li').last().addClass("preselected1")
               }
               else {
                  var gliderDropdownStr = ('<li><a>' + gliderNames[g] + '</a></li>');
                  $('.dropdownSelectGliders').append(gliderDropdownStr);
                  $('.dropdownSelectGliders li').last().addClass("selectGlider1")
               }  
             }

            // Display plots of new period
            // Surface
            var $list = $('<div />');
            $list.addClass('plot_data'); 
            $list.append( $('<img class="img-responsive center-block" />').attr('src', tracks_name ) );
            var tracks_name = ('gliders/' + gliderNames[0]  + '/surface/GliderTrack-LastSegment.png');
            //$list.append( $('<img class="img-responsive center-block" />').attr('src', tracks_name ) ); 
            $(tvars ).each(function(i, myvar) { 
               var png_src = ('gliders/' + gliderNames[0] + '/surface/' + myvar + '.png');
               $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
            });
            $('#surface').append( $list );

            // Flight
            var $list = $('<div />');
            $list.addClass('plot_data'); 
            $(fvars ).each(function(i, myvar) { 
               var png_src = ('gliders/' + gliderNames[0] + '/eng_transects/LastSegment-' + myvar + '.png');
               $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
            });
            $('#flight').append( $list );

            // Science
            var $list = $('<div />');
            $list.addClass('plot_data'); 
            $(svars_seg ).each(function(i, myvar) { 
               var png_src = ('gliders/' + gliderNames[0] + '/sci_transects/LastSegment-' + myvar + '.png');
               $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
            });
            $('#science').append( $list );

            // Science 2 - Depth Profile
            var $list = $('<div />');
            $list.addClass('plot_data'); 
            $(svars_seg_2 ).each(function(i, myvar) { 
               var png_src = ('gliders/' + gliderNames[0] + '/sci_transects/LastSegment-' + myvar + '.png');
               $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
            });
            $('#depthProfile').append( $list );
         });   

         // --- Clear current time period by deleting class "selected" then apply this to new selection ---
         $(".selectGlider").click(function(){
               var selText = $(this).text();
               $('.preselected').removeClass('preselected'); 
               $(this).addClass("preselected");
               $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
         });

         // --- Clear current glider by deleting class "selected1" then apply this to new selection ---
         $('body').on('click', '.selectGlider1', function () {
            var selText = $(this).text();
            $('.preselected1').removeClass('preselected1'); 
            $(this).addClass("preselected1")
            $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
         });

         // --- Display button function ---
         $("#displayBtn").click(function(){
            // Get newly selected time period
            var thisTime = $('.timeBtn').text().replace(/\s+/g, '');
            // Get newly selected  glider
            var thisGlider = $('.gliderBtn').text().trim();
            // Old time 
            var oldTime = $('.selected').text().replace(/\s+/g, '');
            // Old glider
            var oldGlider = $('.selected1').text().trim();

            // Only proceed if these these both aren't the current settings
            if ((thisGlider != oldGlider) | (thisTime != oldTime)) {

               // Remove selected classes and apply to new selections
               $('.selected').removeClass('selected'); 
               $('.selected1').removeClass('selected1');
               $('.preselected').addClass("selected");
               $('.preselected1').addClass("selected1");

               // Delete current plots
               $(".plot_data").remove();

               // Add new plots
               // Surface
               var $list = $('<div />');
               $list.addClass('plot_data'); 
               if (thisTime == 'LastSegment') {
                  };
               var tracks_name = ('gliders/' + thisGlider  + '/surface/GliderTrack-' + thisTime + '.png');
               //$list.append( $('<img class="img-responsive center-block" />').attr('src', tracks_name ) ); %%CHANGE 6-MAR-2019
               $(tvars ).each(function(i, myvar) { 
                  var png_src = ('gliders/' + thisGlider + '/surface/' + myvar + '.png');
                  $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
               });
               $('#surface').append( $list );

               // Flight
               var $list = $('<div />');
               $list.addClass('plot_data'); 
               if (thisTime == 'LastSegment') {
                  };
               $(fvars ).each(function(i, myvar) { 
                  var png_src = ('gliders/' + thisGlider + '/eng_transects/' + thisTime + '-' + myvar + '.png');
                  $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
               });
               $('#flight').append( $list );

                  // Science
                  var $list = $('<div />');
                  $list.addClass('plot_data'); 
                  if (thisTime == 'LastSegment') {
                     $(svars_seg ).each(function(i, myvar) { 
                     var png_src = ('gliders/' + thisGlider + '/sci_transects/' + thisTime + '-' + myvar + '.png');
                     $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
                  });
                     } else {
                  $(svars ).each(function(i, myvar) { 
                     var png_src = ('gliders/' + thisGlider + '/sci_transects/' + thisTime + '-' + myvar + '.png');
                     $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
                  });
                  };
                  $('#science').append( $list );

                  // Science 2 - Depth Profile
                  var $list = $('<div />');
                  $list.addClass('plot_data'); 
                  if (thisTime == 'LastSegment') {
                     $(svars_seg_2 ).each(function(i, myvar) { 
                     var png_src = ('gliders/' + thisGlider + '/sci_transects/' + thisTime + '-' + myvar + '.png');
                     $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
                  });
                     } else {
                  $(svars_2 ).each(function(i, myvar) { 
                     var png_src = ('gliders/' + thisGlider + '/sci_transects/' + thisTime + '-' + myvar + '.png');
                     $list.append( $('<img class="img-responsive center-block" />').attr('src', png_src ) );
                  });
                  };
                  $('#depthProfile').append( $list );
            }
         });





      </script>
   </body>
</html>